!function(t){"use strict";t((function(){var n,e=null,o=null,i=t(".the7-import-feedback"),r=t(".dt-dummy-content"),a={feedback:null,beforePluginsInstallation:function(){},onActionStart:function(t){this.feedback=v(t,i)},onActionDone:function(n){this.feedback.replaceWith(t('<p class="the7-updated">'+n+"</p>"))},onActionFail:function(n){this.feedback.replaceWith(t('<p class="the7-error">'+n+"</p>"))}},s={import_attachments:function(t,n,e){return t.then((function(){let t=D(n);if(d||(d=t),e.importActions){const n=e.importActions.getRetries();n&&(t=d+" Retry... "+n)}return _(n,e,v(t,i))}))},install_plugins:function(n,e,o){var i=a,r=o.plugins_to_install,s=o.plugins_to_activate,d=dtDummy.plugins_page_url,p=dtDummy.strings.plugins_installation_error;if(!s&&!r)return o.importActions&&o.importActions.done(e.dummy),n;return i.beforePluginsInstallation(t.merge([],r,s)),r.forEach((function(e){n=n.then((function(){var n=e;return void 0!==dtDummy.plugins[e]&&(n=dtDummy.plugins[e]),i.onActionStart(dtDummy.strings.installing_plugin+" "+n),t.post(d,{action:"tgmpa-bulk-install",just_install:!0,tgmpa_install_protected_plugins:o.tgmpa_install_protected_plugins||"",noheader:!0,plugin:e}).then((function(n){var e=t.Deferred();return t(n).find(".update-php div.error p").length>0?e.reject(n):e.resolve(n),e.promise()})).done((function(n){var e=t(n).find(".update-php div.updated p");e.find(".js-update-details-toggle").remove(),i.onActionDone(e.text())})).fail((function(n){var o=t(n).find(".update-php div.error p");i.onActionFail(o.length?o.text():p,e)}))}))})),n=(n=n.then((function(){return i.onActionStart(dtDummy.strings.activating_plugin),t.merge(s,r),t.post(d,{action:"tgmpa-bulk-activate",noheader:!0,context:"demo_install",plugin:s}).done((function(t){i.onActionDone(dtDummy.strings.plugins_activated)})).fail((function(){i.onActionFail(p)}))}))).then((function(){return i.onActionStart(dtDummy.strings.rid_of_redirects),t.get(d,{noheader:!0}).done((function(){o.importActions&&o.importActions.done(e.dummy),i.onActionDone(dtDummy.strings.rid_of_redirects)})).fail((function(){i.onActionFail(p)}))}))},import_by_url:function(n,e,o){return f(n,t.extend({},e,{provided_url:o.provided_url}),o)},import_one_post:function(n,e,o){return f(n,t.extend({},e,{post_to_import:o.post_to_import}),o)},remove_content:function(t,n,e){return h(t,{action:"the7_remove_demo_content",_wpnonce:dtDummy.remove_demo_nonce,demo:e.demo_id,dummy:"remove_content"}).always(A)},keep_content:function(t,n,e){return h(t,{action:"the7_keep_demo_content",_wpnonce:dtDummy.nonces.keep_demo_content,demo:e.demo_id,dummy:"keep_content"}).always(A)}};let d="";const p=function(t){this.actions=t,this.retryAttempts=0};p.prototype.get=function(){return this.actions},p.prototype.done=function(t){this.actions=this.actions.filter((function(n){return n!==t})),this.dropRetryAttempts()},p.prototype.getRetries=function(){return this.retryAttempts},p.prototype.attemptRetry=function(){return this.retryAttempts+=1,this.canRetry()&&this.isActionRetriable()?this:null},p.prototype.isActionRetriable=function(){return this.actions&&["import_attachments"].includes(this.actions[0])},p.prototype.canRetry=function(){return this.retryAttempts<=3},p.prototype.dropRetryAttempts=function(){this.retryAttempts=0};new(function(){function n(n,e){this.insertAfterObj=t(e),this.noticeID=n,this.noticeTplObj=t('<div id="'+n+'" class="the7-dashboard-notice the7-notice notice is-dismissible"></div>'),t("body").on("click","#"+n+" .notice-dismiss",(function(){t("#"+n).remove()}))}return n.prototype.addError=function(n,e){if(!n)return t();t("html, body").animate({scrollTop:0},400);return this.noticeTplObj.clone().html(n+'<button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button>').addClass(e).insertAfter(this.insertAfterObj)},n.prototype.removeErrors=function(){t("#"+this.noticeID).remove()},n.prototype.prepareMsg=function(t){return"<p><strong>"+t+"</strong></p>"},n.prototype.addMsg=function(t,n){return this.addError(this.prepareMsg(t),n)},n}())("the7-demo-content-error",".wrap > .wp-header-end");var c={bootstrap:function(){var n=this;t(".nav-tab-wrapper").show(),this.showOptionsTab(t(".nav-tab-wrapper a.nav-tab-active").attr("id")),t(".tabs-holder").removeClass("hidden"),t(".nav-tab-wrapper a").on("click.the7.tabs",(function(t){n.onTabClick(t,this)})),t(window).on("popstate.the7.tabs",this.onPopstate.bind(this))},convertTab2Group:function(t){return t.replace("-tab","-group")},showOptionsTab:function(n){if(n){var e=this.convertTab2Group(n);t(".group").hide().filter("#"+e).fadeIn(),t(".nav-tab-wrapper a").removeClass("nav-tab-active").filter("#"+n).addClass("nav-tab-active").blur()}},onTabClick:function(n,e){n.preventDefault();var o=t(e);if(o.hasClass("blocked"))return!1;var i=o.attr("id");return this.showOptionsTab(i),history.pushState({activeGroupId:"#"+this.convertTab2Group(i)},"",o.attr("href")),!1},onPopstate:function(n){var e={};if(location.search.substr(1).split("&").forEach((function(t){e[t.split("=")[0]]=t.split("=")[1]})),e.tab)var o=e.tab;else o=t(".nav-tab-wrapper a").first().attr("id");this.showOptionsTab(o)},blockTabs:function(){t(".nav-tab-wrapper a").removeClass("blocked").addClass("blocked")},unblockTabs:function(){t(".nav-tab-wrapper a").removeClass("blocked")}};function u(t){this.button=t}function m(t){this.container=t}function l(t){this.id=t.attr("data-dummy-id"),this.title=t.find("h3").first().text(),this.url=w(t.find(".dt-dummy-screenshot a").first().attr("href")),this.tags=JSON.parse(t.attr("data-tags")),this.container=t,this.settings=t.find(".dt-dummy-field input"),this.errors=new m(t.find(".the7-demo-notifications")),this.buttons={import:new u(t.find(".dt-dummy-button-import")),onePageImport:new u(t.find(".dt-dummy-button-import-one-page")),remove:new u(t.find(".dt-remove-content-button")),keep:new u(t.find(".dt-keep-content-button"))},this.addEvents()}function h(n,e,o,r){return n.then((function(){var n=D(e);return void 0===r&&(r=v(n,i)),t.post(ajaxurl,e).then(k).done((function(i){o&&o.importActions&&o.importActions.done(e.dummy),r.replaceWith(t('<p class="the7-updated">'+n+"</p>"))})).fail((function(){r.replaceWith(t('<p class="the7-error">'+n+"</p>"))}))}))}function f(n,e,o){return n.then((function(){var n=D(e),r=v(n,i);return t.post(ajaxurl,e).then(k).done((function(i){let a=i.data.step2Links,s=t.extend({},e,{imported_post_id:i.data.imported_post_id});r.replaceWith(t('<p class="the7-updated">'+n+"</p>")),o.importActions=new p(i.data.postImportActions),o.onDone=function(){t("#the7-demo-visit-site-link").replaceWith(a),A()},y(o.importActions,s,o)})).fail((function(){r.replaceWith(t('<p class="the7-error">'+n+"</p>"))}))}))}function y(n,e,o){if(!n||!n.get())return;let r=t.when();return n.get().forEach((function(n){let i=t.extend({},e,{dummy:n});r=s.hasOwnProperty(n)?s[n](r,i,o):h(r,i,o)})),r.fail((function(r){if(n.attemptRetry())y(n,e,o);else{var a=new m(i);void 0!==r.data&&void 0!==r.data.error_msg&&r.data.error_msg?a.addText(r.data.error_msg):a.addPHPStatus(),t(".the7-go-back-link").html(dtDummy.strings.go_back_with_error),A()}})),o.onDone&&r.done(o.onDone),r}function _(n,e,o){return t.post(ajaxurl,n).then(k).then((function(i){return d=D({dummy:"import_attachments"})+" ("+i.data.imported+"/"+i.data.total+")",d===o.text().trim()?k(null):0!=i.data.left?(e.importActions&&e.importActions.dropRetryAttempts(),_(n,e,(r=o,a=v(d),r.replaceWith(a),a))):(e.importActions&&e.importActions.done(n.dummy),void o.replaceWith(t('<p class="the7-updated">'+D(n)+"</p>")));var r,a})).fail((function(){e.importActions&&e.importActions.canRetry()?o.remove():o.replaceWith(t('<p class="the7-error">'+D(n)+"</p>"))}))}function v(n,e){var o=t('<p><span class="spinner is-active" style="float: none; margin: 0"></span> '+n+"</p>");return void 0!==e&&e.append(o),o}function b(n,o){var i=o.find("select.dt-dummy-content-posts");i.empty(),t.each(e[n],(function(t,n){i.append('<option id="'+t+'"  value="'+t+'">'+n.post_title+"</option>")})),g(o)}function g(t){var n=t.find("select.dt-dummy-content-posts").val(),o=t.find("select.dt-dummy-content-post-type").val(),i=t.find(".dt-dummy-one-post-url");null!=n&&null!=o?(i.attr("href",e[o][n].url),i.show()):i.hide()}function D(t){var n=t.dummy;return void 0!==dtDummy.strings[t.dummy]&&(n=dtDummy.strings[t.dummy]),n}function w(t){return"https://"+t.replace(/[\?#].*/,"").replace(/\/?$/,"/").replace("https://","")}function A(){t(".the7-go-back-link").removeClass("hide-if-js")}function k(n){var e=t.Deferred();return n.success?e.resolve(n):e.reject(n),e.promise()}c.bootstrap(),"undefined"!=typeof the7ImportData&&(the7ImportData.importActions=new p(the7ImportData.actions),"full_import"===the7ImportData.import_type&&(the7ImportData.onDone=A),y(the7ImportData.importActions,{action:"the7_import_demo_content",content_part_id:the7ImportData.demo_id,user_map:the7ImportData.users,imported_authors:["admin"],_wpnonce:dtDummy.import_nonce,import_type:the7ImportData.import_type||"full_import"},the7ImportData)),t(".dt-dummy-control-buttons .dt-dummy-button-import-one-page").on("click",(function(i){var r,a,s=t(this),d=s.closest(".dt-dummy-content"),p=d.data("the7Demo"),u=[t(".dt-dummy-content-user",d).first().val()],m=t.when();i.preventDefault(),p.errors.clear(),p.buttons.onePageImport.setBusy(dtDummy.strings.loading),r=t("#full-site-group"),a=r.find("button").not(":disabled"),r.data("the7ButtonsToEnable",a),a.prop("disabled","disabled"),c.blockTabs(),function(t,e){var i=t.attr("data-dummy-id")||"0";void 0===n||i===o&&!e||(n.slideDown(),n.parent().find(".dt-dummy-one-page-importing-interface").remove());o=i}(d,!1),["download_package","get_posts"].forEach((function(t){m=h(m,{action:"the7_import_demo_content",_wpnonce:dtDummy.import_nonce,dummy:t,user_map:u,content_part_id:p.id})})),m.done((function(o){void 0!==o.data&&void 0!==o.data.response&&"getPostsList"===o.data.response&&(e=o.data.data,(n=s.closest(".dt-dummy-controls-block-import-one-page")).slideUp(400,(function(){var o=t('<div class="dt-dummy-one-page-importing-interface"></div>');n.after(o),function(t){t.empty(),t.hide();var n='<div class="dt-dummy-controls-block" style="padding-bottom: 1em;"><table class="dt-dummy-field dt-dummy-one-post-data"><tr><td>'+dtDummy.strings.one_post_importing_choose_posttype+': </td><td><select name="the7_import_post_type" id="post-type" class="dt-dummy-content-post-type"></select></td></tr><tr><td>'+dtDummy.strings.one_post_importing_choose_post+': </td><td><select name="the7_import_post_id" id="posts" class="dt-dummy-content-posts"></select> <a class="the7-tip dt-dummy-one-post-url" href="#" target="_blank">'+dtDummy.strings.one_post_importing_url_msg+"</a></td></tr></table></div>",e='<div class="dt-dummy-controls-block dt-dummy-control-buttons"><div class="dt-dummy-button-wrap"><button type="submit" class="button button-primary dt-dummy-button-import-one-page-submit">'+dtDummy.strings.one_post_importing_import+"</button></div></div>";void 0!==t&&(t.append(n),t.append(e))}(o),function(n){var o=n.find("select.dt-dummy-content-post-type");o.html(""),t.each(e,(function(t,n){o.append('<option id="'+t+'"  value="'+t+'">'+t+"</option>")})),g(n)}(o),o.slideDown(),b(o.find("select.dt-dummy-content-post-type").val(),o),o.find("select.dt-dummy-content-post-type").on("change",(function(t){b(this.value,o)})),o.find("select.dt-dummy-content-posts").on("change",(function(t){g(o)}))})))})),m.fail((function(t){void 0!==t.data&&void 0!==t.data.error_msg&&t.data.error_msg?p.errors.addText(t.data.error_msg):p.errors.addPHPStatus()})),m.always((function(){!function(){var n=t("#full-site-group"),e=n.data("the7ButtonsToEnable");if(n.removeData("the7ButtonsToEnable"),!e||!e.length)return;e.removeAttr("disabled"),c.unblockTabs()}(),p.buttons.onePageImport.setFree()}))})),t(".the7-demo-quick-search .the7-demo-tag").on("click",(function(){var n=t(this).attr("data-tag"),e=t("#dt-dummy-search-input");e.val(e.val()+" "+n+" ").trigger("search").focus()})),t("#dt-dummy-search-input").on("search keyup",(function(){var n=t(this).val().toLowerCase(),e=n.split(" ");1!==n.length&&r.filter((function(t,n){return!0})).each((function(){var o=t(this),i=o.data("the7Demo"),r=!1,a=i.title.toLowerCase()+" "+i.tags.join(" ").toLowerCase();(e.every((function(t){return a.includes(t)}))||i.url.toLowerCase().includes(w(n)))&&(r=!0),r?o.show():o.hide()}))})),t(".dt-remove-content-button").on("click",(function(t){window.confirm(dtDummy.strings.remove_content_confirm)||t.preventDefault()})),t(".dt-keep-content-button").on("click",(function(t){window.confirm(dtDummy.strings.keep_content_confirm)||t.preventDefault()})),u.prototype.disable=function(){this.button.prop("disabled",!0)},u.prototype.enable=function(){this.button.prop("disabled",!1)},u.prototype.setBusy=function(t){this.setFree(),this.button.addClass("button--importing").prop("disabled",!0),void 0!==t&&(this.button.data("the7ButtonOriginCaption",this.button.text()),this.button.text(t)),this.button.siblings(".spinner").first().addClass("is-active")},u.prototype.setFree=function(t){var n=this.button.data("the7ButtonOriginCaption");this.button.siblings(".spinner").first().removeClass("is-active"),this.button.removeClass("button--importing").prop("disabled",!1),n&&this.button.text(n)},m.prototype.addText=function(t){this.add("<p>"+t+"</p>")},m.prototype.add=function(n){var e=t('<div class="dt-dummy-inline-msg hide-if-js inline error">'+n+"</div>");this.container.append(e),e.slideDown()},m.prototype.clear=function(){this.container.slideUp().html("")},m.prototype.addPHPStatus=function(){var n=this;t.post(ajaxurl,{action:"the7_demo_content_php_status",_wpnonce:dtDummy.status_nonce,demo_id:the7ImportData.demo_id,import_data:the7ImportData}).then(k).done((function(t){t.data?n.add(t.data):n.addText(dtDummy.strings.msg_import_fail)})).fail((function(){n.addText(dtDummy.strings.msg_import_fail)}))},l.prototype.addEvents=function(){var n=this;this.settings.on("change",(function(){var e=t(this),o=e.data("affectedSettings")||n.container.find(".dt-dummy-field :input").not("[name=install_plugins], [name=import_theme_options], :disabled");"install_plugins"===e.attr("name")&&(e.data("affectedSettings",o),e.is(":checked")?(o.removeAttr("disabled").parents(".dt-dummy-field").removeClass("disabled"),e.removeData("affectedSettings")):o.attr("disabled","disabled").parents(".dt-dummy-field").addClass("disabled")),n.maybeChangeImportButtonState()}))},l.prototype.getActions=function(){var n=[];return this.settings.filter(":checked").not(":disabled").each((function(){n.push(t(this).attr("name"))})),n.indexOf("import_theme_options")>=0&&(n=n.filter((function(t){return"import_theme_options"!==t}))).push("import_theme_options"),n},l.prototype.maybeChangeImportButtonState=function(){this.getActions().filter((function(t){return"install_plugins"!==t})).length?this.buttons.import.enable():this.buttons.import.disable()},r.each((function(){var n=t(this);n.data("the7Demo",new l(n))}))}))}(jQuery);